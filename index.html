<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>polimiru | æ”¿æ²»ã‚’å¯è¦–åŒ–ã™ã‚‹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ </title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/header-footer.css">
    <link rel="stylesheet" href="css/hero.css">
    <link rel="stylesheet" href="css/elections.css">
    <link rel="stylesheet" href="css/modal.css">
</head>
<body>

    <div class="platform-hero">
        <h1>æ”¿æ²»ã‚’ã€ã‚‚ã£ã¨é€æ˜ã«ã€‚</h1>
        <p>
            ã€Œè¨€ã£ãŸã“ã¨ã€ã¨ã€Œã‚„ã£ãŸã“ã¨ã€ã®ã‚®ãƒ£ãƒƒãƒ—ã‚’å¯è¦–åŒ–ã™ã‚‹ã€‚<br>
            æ—¥æœ¬æœ€å¤§ç´šã®æ”¿æ²»å®¶ãƒ•ã‚¡ã‚¯ãƒˆãƒã‚§ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€‚
        </p>

        <div class="score-short-explain">
            å…¬ç´„ãŒã©ã‚Œã ã‘å…·ä½“çš„ã§ã€ã©ã‚Œã ã‘å®Ÿç¾ã—ã‚„ã™ã„ã‹ã‚’æ•°å€¤åŒ–ã—ã¦è©•ä¾¡ã—ã¦ã„ã¾ã™ã€‚<br>
            ç¾è·ã®å€™è£œè€…ã«ã¤ã„ã¦ã¯ã€éå»ã®ç™ºè¨€ã¨å®Ÿéš›ã®è¡Œå‹•ã®ä¸€è‡´åº¦ã‚‚åŠ å‘³ã—ã¦ã„ã¾ã™ã€‚
        </div>

        <div class="search-wrapper">
            <i class="fa-solid fa-magnifying-glass search-icon-overlay"></i>
            <input
                id="search-input"
                class="search-input"
                type="text"
                placeholder="é¸æŒ™åŒºåãƒ»éƒ½é“åºœçœŒãƒ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢..."
            >
        </div>

        <div class="hero-actions">
            <button id="area-btn" class="area-select-btn hero-btn">
                <i class="fa-solid fa-location-dot"></i> <span>ã‚¨ãƒªã‚¢æœªè¨­å®š</span>
            </button>
        </div>
    </div>

    <div class="container">
        
        <div class="filter-tabs">
            <button class="filter-btn active" data-category="all" onclick="filterElections('all')">ğŸ”¥ æ³¨ç›®</button>
            <button class="filter-btn" data-category="national" onclick="filterElections('national')">ğŸ›ï¸ å›½æ”¿</button>
            <button class="filter-btn" data-category="local" onclick="filterElections('local')">ğŸ—¾ åœ°æ–¹</button>
        </div>

        <div class="election-grid" id="election-grid"></div>
    </div>

    <script src="js/elections.js"></script>
    <script src="js/layout.js?v=999"></script>

    <script>
        const grid = document.getElementById('election-grid');
        const savedAreaName = localStorage.getItem('my_area_name') || "";
        const searchInput = document.getElementById('search-input');

        // â˜…ä¿®æ­£ç®‡æ‰€ï¼šéƒ½é“åºœçœŒã”ã¨ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç”»åƒãƒªã‚¹ãƒˆ
        // å¤§é˜ªåºœã®ç”»åƒã‚’æœ‰åŠ¹ãªURLï¼ˆUnsplashã®å¤§é˜ªåŸï¼‰ã«å¤‰æ›´ã—ã¾ã—ãŸ
        const prefectureImages = {
            "æ±äº¬éƒ½": "images/tokyo.jpg", // æ±äº¬ã‚¿ãƒ¯ãƒ¼
            "å¤§é˜ªåºœ": "images/osaka.jpg", // å¤§é˜ªåŸ (ä¿®æ­£æ¸ˆã¿)
            "é•·å´çœŒ": "https://images.unsplash.com/photo-1565627788441-4942d2302d7c?auto=format&fit=crop&w=600&q=80", // çœ¼é¡æ©‹
            "ç¥å¥ˆå·çœŒ": "https://images.unsplash.com/photo-1559517441-2c922da62641?auto=format&fit=crop&w=600&q=80", // æ¨ªæµœ
            "å›½æ”¿": "https://images.unsplash.com/photo-1529101091760-6149976f1581?auto=format&fit=crop&w=600&q=80",   // å›½ä¼šè­°äº‹å ‚
            "default": "https://images.unsplash.com/photo-1480796927426-f609979314bd?auto=format&fit=crop&w=600&q=80" // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆæ—¥æœ¬ã®è¡—ä¸¦ã¿ï¼‰
        };

        // åˆæœŸè¡¨ç¤º
        renderCards('all');

        function filterElections(category) {
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderCards(category);
        }

        function renderCards(category) {
            // ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ãªã„å ´åˆã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
            if (typeof elections === 'undefined') {
                console.error("electionsãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚js/elections.jsãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
                grid.innerHTML = `<p style="text-align:center; color:red;">ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>`;
                return;
            }

            grid.innerHTML = "";

            // 1. ã¾ãšå…¨ãƒ‡ãƒ¼ã‚¿ã‚’ç”¨æ„
            let filteredData = elections;

            // 2. ã€Œã‚¨ãƒªã‚¢è¨­å®šã€ãŒã‚ã‚‹å ´åˆã€ãã®åœ°åŸŸã®é¸æŒ™ã ã‘ã«çµã‚Šè¾¼ã‚€
            if (savedAreaName && savedAreaName !== 'ã‚¨ãƒªã‚¢æœªè¨­å®š') {
                filteredData = filteredData.filter(e => {
                    return e.prefecture === savedAreaName || e.prefecture === 'å›½æ”¿';
                });
            }

            // 3. ã‚¿ãƒ–ã§çµã‚Šè¾¼ã‚€
            if (category === 'national') {
                filteredData = filteredData.filter(e => e.category === 'national');
            } else if (category === 'local') {
                filteredData = filteredData.filter(e => e.category === 'local');
            }

            // 4. æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã§çµã‚Šè¾¼ã‚€
            const query = searchInput.value.trim().toLowerCase();
            if (query) {
                filteredData = filteredData.filter(e => {
                    const title = e.title ? e.title.toLowerCase() : "";
                    const pref = e.prefecture ? e.prefecture.toLowerCase() : "";
                    const desc = e.desc ? e.desc.replace(/<br\s*\/?>/gi,' ').toLowerCase() : "";
                    return title.includes(query) || pref.includes(query) || desc.includes(query);
                });
            }

            // 5. è¡¨ç¤ºãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            if (filteredData.length === 0) {
                const msg = savedAreaName && savedAreaName !== 'ã‚¨ãƒªã‚¢æœªè¨­å®š' 
                    ? `ã€Œ${savedAreaName}ã€ã«é–¢é€£ã™ã‚‹é¸æŒ™ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚` 
                    : `è©²å½“ã™ã‚‹é¸æŒ™ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚`;

                grid.insertAdjacentHTML('beforeend', `
                    <p style="text-align:center; color:#666; grid-column:1/-1; padding: 40px;">
                        ${msg}<br>
                        <small>â€»å³ä¸Šã®ã€Œè¨­å®šã‚’è§£é™¤ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã§å…¨ã¦ã®é¸æŒ™ã‚’è¡¨ç¤ºã§ãã¾ã™ã€‚</small>
                    </p>
                `);
                return;
            }

            // 6. ã‚«ãƒ¼ãƒ‰ã‚’æç”»
            filteredData.forEach(election => {
                const badgeClass = election.badgeType === 'national' ? 'badge-national' : 'badge-local';
                const statusClass = (election.status && election.status.includes('æ³¨ç›®')) ? 'status-active' : '';
                
                const isAreaMatch = savedAreaName === election.prefecture;
                const highlight = isAreaMatch 
                    ? 'border:2px solid #1a2e45; box-shadow:0 0 15px rgba(26,46,69,.2);' 
                    : '';

                // ç”»åƒåˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
                // éƒ½é“åºœçœŒã”ã¨ã®ç”»åƒã‚’è¾æ›¸ã‹ã‚‰å–å¾—ã€ãªã‘ã‚Œã°default
                let imageUrl = prefectureImages[election.prefecture] || prefectureImages['default'];
                
                // ã‚‚ã—ãƒ‡ãƒ¼ã‚¿å€‹åˆ¥ã«æœ‰åŠ¹ãªç”»åƒURLãŒæŒ‡å®šã•ã‚Œã¦ã„ãŸã‚‰ã€ãã¡ã‚‰ã‚’å„ªå…ˆã™ã‚‹
                if (election.image && election.image.startsWith('http')) {
                    imageUrl = election.image;
                }

                const html = `
                    <a href="${election.url}" class="election-card" style="${highlight}">
                        <div class="card-thumb" style="background-image:url('${imageUrl}');">
                            <span class="badge ${badgeClass}">${election.prefecture}</span>
                            <span class="status-label ${statusClass}">${election.status}</span>
                        </div>
                        <div class="card-content">
                            <div class="election-title">${election.title}</div>
                            <span class="election-date">ğŸ“… ${election.date}</span>
                            <div class="election-desc">${election.desc}</div>
                        </div>
                    </a>
                `;
                grid.insertAdjacentHTML('beforeend', html);
            });
        }

        // å…¥åŠ›æ™‚ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
        searchInput.addEventListener('input', () => {
            const activeBtn = document.querySelector('.filter-btn.active');
            const category = activeBtn ? activeBtn.dataset.category : 'all';
            renderCards(category);
        });
    </script>
</body>
</html>